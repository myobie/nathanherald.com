#!/bin/bash

set -e

if [[ "$OSTYPE" == "darwin"* ]]; then
  bin/setup

  export AWS_ACCESS_KEY=$(cat infra/variables.tfvars.local | grep -m 1 aws_access_key | awk '{ v=$3; gsub(/"/, "", v); print v }')
  export AWS_SECRET_KEY=$(cat infra/variables.tfvars.local | grep -m 1 aws_secret_key | awk '{ v=$3; gsub(/"/, "", v); print v }')
else
  wget https://bootstrap.pypa.io/pip/3.6/get-pip.py
  python get-pip.py
  pip install s3cmd
fi

if [[ ! -f public/fonts/webfont.zip ]]; then
  s3cmd get \
    --access_key="${AWS_ACCESS_KEY}" \
    --secret_key="${AWS_SECRET_KEY}" \
    s3://nathanheraldcom-font-bucket/webfont.zip \
    public/fonts/webfont.zip

  cd public/fonts &&
    unzip webfont.zip &&
    cd -
fi
