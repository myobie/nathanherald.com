<!doctype html>
<html>
  <head lang="en-us">
    <meta charset="UTF-8">
    <title>I‚Äòm Nathan Herald ‚Üí Building templates for custom elements (web components)</title>
    <script>
      if ((new URL(window.location.href)).host === 'myobie.com') { window.location.assign('https://nathanherald.com') }
    </script>
    <link rel="canonical" href="https://nathanherald.com/posts/building-templates/">
    <link rel="stylesheet" type="text/css" href="https://cloud.typography.com/6836312/761366/css/fonts.css"><link rel="stylesheet" type="text/css" href="/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator" content="Hugo 0.136.5">
    <meta name="title" content="I‚Äòm Nathan Herald  ‚Üí Building templates for custom elements (web components)">
    <meta name="description" content="">
    <meta property="og:title" content="Building templates for custom elements (web components)">
    <meta property="og:type" content="website">
    <meta property="og:description" content="">
    <meta property="og:url" content="https://nathanherald.com/posts/building-templates/">
    <meta property="og:image" content="/og.png">
    <meta property="og:site_name" content="I‚Äòm Nathan Herald">
    
  

<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Feed of all the posts on nathanherald.com">


  </head>
  <body class="default">
    
  <header class="section-header">
    <div class="section-nav">
      <h1 class="home-link">
        <a data-nospan href="/" class="never-underline"><abbr title="Hello">üëã</abbr></a>
        <a href="/">I&rsquo;m Nathan</a>
      </h1>
      <nav>
        <p>
          Find more in the <a href="https://nathanherald.com/posts/">archive of all the posts on this site</a>
or <a href="https://nathanherald.com/posts/rss.xml">subscribe with RSS</a>.

        </p>
      </nav>
    </div>
  </header>

    
  <main class="single">
    <article>
      <header>
        <h1>
          
          
            Building templates for custom elements (web components)
            <p class="annotation">‚≠êÔ∏è a blog post</a>
          
        </h1>
        
      </header>

      <div class="content">
        <h2 id="what-is-template">What is <code>&lt;template&gt;</code>?</h2>
<p>If you, like me, have ever tried to use it for ‚Äútemplating‚Äù then you‚Äôve probably also been frustrated. I‚Äôve now used <code>&lt;template&gt;</code> enough that I think I get it, I think I understand what it‚Äôs good for. And it‚Äôs not templating.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template"><code>&lt;template&gt;</code> is for holding document fragments.</a> That‚Äôs it.</p>
<p>Those DOM fragments are reusable. They expose a <code>cloneNode()</code> function which allows one to duplicate it, to then be inserted somewhere. The template‚Äôs content doesn‚Äôt change, <code>cloneNode()</code> just makes a duplicate.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">template</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;p&gt;&lt;em&gt;Hello&lt;/em&gt;&lt;/p&gt;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// true means deep clone, you almost always want this
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">frag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// appending a fragment will move all of its children into the target element
</span></span></span></code></pre></div><p>The above doesn‚Äôt feel like what I would call ‚Äúa template.‚Äù</p>
<p>If you needed 10 <code>&lt;p&gt;A&lt;/p&gt;</code>s all the same, then this would work great. But most of the time I have some <em>shared markup</em> that I want to reuse, like for building up a list of grocery items for example. I might want to share something like <code>&lt;li&gt;${name}&lt;/li&gt;</code> and then reuse that over and over for each grocery item.</p>
<p>This is a way to make the grocery list using <code>&lt;template&gt;</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">groceryItems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;milk&#39;</span><span class="p">,</span> <span class="s1">&#39;eggs&#39;</span><span class="p">,</span> <span class="s1">&#39;eggos&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">template</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;li&gt;&lt;/li&gt;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">groceryItems</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">frag</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">frag</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">item</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ul</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">frag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">ul</span><span class="p">)</span>
</span></span></code></pre></div><p>This feels like a lot to just place the grocery item‚Äôs name into the <code>&lt;li&gt;</code> for each.</p>
<p>Most of us are used to writing something like this in JSX:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="nx">groceryItems</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;{</span><span class="nx">item</span><span class="p">}&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">))}</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>JSX is not available in the browser tho. It requires a build system‚Ä¶ and it‚Äôs XML and not HTML. <em>And</em> if you‚Äôve ever had to put in a <code>{' '}</code>, well, there are edge cases üòâ</p>
<p>What we do have in the browser are <em>template strings.</em></p>
<h2 id="template-strings">Template strings</h2>
<p>Unrelated to <code>&lt;template&gt;</code>, template strings are those backtick multi-line strings that can interpolate stuff. Like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">say</span><span class="p">(...</span><span class="nx">what</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(...</span><span class="nx">what</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">say</span><span class="p">(</span><span class="sb">`Hello </span><span class="si">${</span><span class="nx">number</span><span class="si">}</span><span class="sb"> Again`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// =&gt; &#39;Hello 5 Again&#39;
</span></span></span></code></pre></div><p>There is another way to call a function with a template string though:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">say</span><span class="sb">`Hello </span><span class="si">${</span><span class="nx">number</span><span class="si">}</span><span class="sb"> Again`</span>
</span></span><span class="line"><span class="cl"><span class="c1">// =&gt; [&#34;Hello &#34;, &#34; Again&#34;]
</span></span></span><span class="line"><span class="cl"><span class="c1">// =&gt; 5
</span></span></span></code></pre></div><p>And that is incredibly different. By removing the parentheses and putting the backticks up against the function, it calls it <strong>before</strong> interpolating the number.</p>
<p>You are expected to zip the first array with all the following arguments. If you look at the above example, you can see how first comes a string, then the five, then another string, and then we are done.</p>
<p>Implementing that type of zipping of arrays is annoying‚Ä¶ and luckily there is a built in function that will do it for you: <code>String.raw()</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">say</span><span class="p">(</span><span class="nx">strings</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">raw</span><span class="p">({</span> <span class="nx">raw</span><span class="o">:</span> <span class="nx">strings</span> <span class="p">},</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">say</span><span class="sb">`Hello </span><span class="si">${</span><span class="nx">number</span><span class="si">}</span><span class="sb"> Again`</span>
</span></span><span class="line"><span class="cl"><span class="c1">// =&gt; &#39;Hello 5 Again&#39;
</span></span></span></code></pre></div><p>Let‚Äôs make a sweet <code>html</code> function that can take a template string and return an <code>HTMLTemplateElement</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">html</span><span class="p">(</span><span class="nx">strings</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">raw</span><span class="p">({</span> <span class="nx">raw</span><span class="o">:</span> <span class="nx">strings</span> <span class="p">},</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">source</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">template</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="s1">&#39;Milk&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">html</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    &lt;li&gt;</span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb">&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span></code></pre></div><p>Which is super cool. That already looks <em>more templatey</em> to me. There is still some work to do to though be able to interpolate the entire grocery list, so let‚Äôs get to it.</p>
<p>I feel like I need to be able to nest templates to build the full grocery list‚Ä¶ so I need to pre-process <code>args</code> before passing it to <code>String.raw()</code> to deal with any interpolated templates.</p>
<p>To make this easier, I‚Äôd like to package this up into my own class so I can keep some state and more easily detect a nested template.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">Template</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">#</span><span class="nx">embeddedTemplates</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="p">...</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// pre-process the template string values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">updatedValues</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">prepareValues</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// zip
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">raw</span><span class="p">({</span> <span class="nx">raw</span><span class="o">:</span> <span class="nx">source</span> <span class="p">},</span> <span class="p">...</span><span class="nx">updatedValues</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// assign as the source
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">source</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">#</span><span class="nx">prepareValues</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">prepareValue</span> <span class="o">=</span> <span class="nx">v</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">v</span> <span class="o">===</span> <span class="s1">&#39;boolean&#39;</span> <span class="o">||</span> <span class="nx">v</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">v</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// if someone interpolates nothing, return an empty string and move on
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="k">instanceof</span> <span class="nx">Template</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// if we find a template, store it in our Map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">embeddedTemplates</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// substitute a small custom element including the index in the Map for this embedded template
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// our template content must be a string, so we are using this little custom element to stand in for our non-string Template object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="sb">`&lt;t- data-i=&#34;</span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">&#34;&gt;&lt;/t-&gt;`</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">values</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">v</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// just in case someone interpolated an array, then let&#39;s map over it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">v</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">prepareValue</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">prepareValue</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// we&#39;ll just always imagine it&#39;s true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">cloneNode</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// find all those custom elements that are standing in for embedded template objects
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">embeddedTemplates</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;t-&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// for each custom element, replace it with the cloned fragment of the template object it&#39;s standing in for
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">embeddedTemplates</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">t</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">i</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="err">#</span><span class="nx">embeddedTemplates</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">t</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">node</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>I know that is a lot. I added comments to the code and hopefully that helps a bit.</p>
<p>With that class, I can now write:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">html</span><span class="p">(</span><span class="nx">strings</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nx">Template</span><span class="p">(</span><span class="nx">strings</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">html</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    </span><span class="si">${</span><span class="nx">groceryItems</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="nx">html</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">      &lt;li&gt;</span><span class="si">${</span><span class="nx">item</span><span class="si">}</span><span class="sb">&lt;/li&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">    `</span><span class="p">)</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">  &lt;/ul&gt;
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">()</span>
</span></span></code></pre></div><p>That is looking very <em>templatey.</em> Hopefully you can see the nested <code>html</code> call in there.</p>
<p>This should give us the html we expect.</p>
<p><a href="https://codepen.io/myobie/pen/WbewXxB?editors=0010">This codepen has a working example</a>.</p>
<hr>
<p>The resulting DOM list isn‚Äôt reactive. If I want to add a new item to the grocery list, it won‚Äôt update. And that is a bigger topic for another post, hopefully soon.</p>
<p>Hit me up on <a href="https://indieweb.social/@myobie">mastodon</a> and let me know what you think of my <code>Template</code> class, how are you handling templating with custom elements, or anything else ü´°</p>

      </div>

      <footer>
        
        <p>
          
            Posted on
          
          <time datetime="2024-12-07T21:51:46&#43;01:00">
            7 Dec, 2024
          </time>
          
          
          
        </p>
      </footer>
    </article>
  </main>

    
    
    <script async src="/behavior.js"></script>
      <script defer data-domain="nathanherald.com" src="https://stats.myobie.wtf/script.js"></script>
  </body>
</html>
